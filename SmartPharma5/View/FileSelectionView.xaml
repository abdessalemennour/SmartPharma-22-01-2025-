<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:dxcv="clr-namespace:DevExpress.Maui.CollectionView;assembly=DevExpress.Maui.CollectionView"
             x:Class="SmartPharma5.View.FileSelectionView"
             Title="Select File"
             BackgroundColor="#F5F5F5">
    <Grid>
        <StackLayout>
            <!-- Barre horizontale en haut avec les boutons "Add File" et "Take Photo" -->
            <StackLayout Orientation="Horizontal">

                <Frame HorizontalOptions="FillAndExpand">
                    <Button Clicked="OnAddFileClicked"
                            VerticalOptions="CenterAndExpand"
                            HeightRequest="40"
                            CornerRadius="30"
                            Text="Add File" />
                </Frame>
                <Frame x:Name="added" HorizontalOptions="FillAndExpand">
                    <Button Clicked="OnTakePhotoClicked"
                            VerticalOptions="CenterAndExpand"
                            BackgroundColor="ForestGreen"
                            HeightRequest="40"
                            CornerRadius="30"
                            Text="Take Photo" />
                </Frame>
            </StackLayout>

            <!-- CollectionView pour afficher les documents récupérés -->
            <RefreshView IsRefreshing="{Binding ActPopup}" 
             Command="{Binding RefreshCommand}" 
             HorizontalOptions="CenterAndExpand" 
             RefreshColor="#4B9EE8">
                <dxcv:DXCollectionView x:Name="DocumentsCollectionView" 
                           ItemsSource="{Binding Documents, Mode=TwoWay}" 
                           ItemSpacing="1">
                    <!-- Define the item template -->
                    <dxcv:DXCollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="8" 
                       HasShadow="True" 
                       BorderColor="{Binding ValidatedColor}" 
                       Padding="0">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="TapGestureRecognizer_Tapped"/>
                                </Frame.GestureRecognizers>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Partie gauche : Détails du fichier -->
                                    <StackLayout Grid.Column="0" Padding="10">
                                        <!-- Nom et type sur la même ligne -->
                                        <StackLayout Orientation="Horizontal" Spacing="5">
                                            <Label Text="{Binding name}" 
                                       FontSize="Medium" 
                                       TextColor="#55575c" 
                                       FontAttributes="Bold" />
                                            <Label Text="{Binding extension}" 
                                       FontSize="Medium" 
                                       TextColor="#55575c" 
                                       FontAttributes="Bold" />
                                        </StackLayout>

                                        <!-- Date de création en dessous du nom -->
                                        <Label Text="{Binding create_date, StringFormat='Created: {0:dd/MM/yyyy HH:mm}'}" 
                                   FontSize="Caption" 
                                   TextColor="#959aa0" 
                                   FontAttributes="Bold" 
                                   Margin="0,5,0,0" />

                                        <!-- Memo -->
                                        <Label Text="{Binding memo, StringFormat='Memo: {0}'}" 
                                   FontSize="Caption" 
                                   TextColor="#959aa0" 
                                   Margin="0,5,0,0" />

                                        <!-- Description -->
                                        <Label Text="{Binding description, StringFormat='Description: {0}'}" 
                                   FontSize="Caption" 
                                   TextColor="#959aa0" 
                                   Margin="0,5,0,0" />
                                    </StackLayout>

                                    <!-- Partie droite : Boutons -->
                                    <StackLayout Grid.Column="1" 
                                     VerticalOptions="Center" 
                                     Padding="10">
                                        <!-- Bouton VIEW DETAILS -->
                                        <ImageButton Margin="5" 
                                             VerticalOptions="Center" 
                                             HorizontalOptions="End" 
                                             Padding="5" 
                                             Source="view_details_icon.png"
                                            BackgroundColor="Transparent" 
                                             Clicked="ViewDetails_Clicked" 
                                             CommandParameter="{Binding .}" />      

                                        <!-- Bouton DELETE remplacé par une icône -->
                                        <ImageButton Margin="5" 
                                         VerticalOptions="Center" 
                                         HorizontalOptions="End" 
                                         Padding="5" 
                                         Source="delete_icon.png"
                                            BackgroundColor="Transparent" 
                                         Clicked="OnDeleteClicked" 
                                         CommandParameter="{Binding .}" />
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </dxcv:DXCollectionView.ItemTemplate>
                </dxcv:DXCollectionView>
            </RefreshView>
        </StackLayout>
    </Grid>
</ContentPage>